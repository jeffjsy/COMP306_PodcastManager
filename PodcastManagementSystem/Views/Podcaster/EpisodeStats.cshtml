@* File: Views/Podcaster/EpisodeStats.cshtml *@
@model PodcastManagementSystem.Models.ViewModels.EpisodeStatsViewModel
@{
    ViewData["Title"] = $"Analytics: {Model.PodcastTitle}";
}

<h2 class="text-primary mt-4 mb-3">📈 Analytics: @Model.PodcastTitle</h2>
<p class="text-muted">Click on a column header to sort the data.</p>
<hr />

@* ... card structure ... *@

<table id="episodeStatsTable" class="table table-hover">
    <thead>
        <tr>
            <th scope="col" data-sort="number">#</th>
            <th scope="col" data-sort="string">Episode Title</th>

            @* 🌟 RELEASE DATE HEADER 🌟 *@
            <th scope="col" class="text-start" data-sort="date">Release Date</th>

            @* 🌟 VIEW COUNT HEADER 🌟 *@
            <th scope="col" class="text-end" data-sort="number">View Count</th>

            <th scope="col" class="text-end" data-sort="number">Comment Count</th>
        </tr>
    </thead>
    <tbody>
        @{
            var rank = 1;
        }
        @foreach (var episode in Model.TopEpisodes)
        {
            <tr>
                <th scope="row">@rank</th>
                <td>@episode.EpisodeTitle</td>

                @* 🌟 RELEASE DATE DATA 🌟 *@
                <td>@episode.ReleaseDate.ToShortDateString()</td>

                <td class="text-end">@episode.ViewCount.ToString("N0")</td>
                <td class="text-end">@episode.CommentCount.ToString("N0")</td>
            </tr>
            rank++;
        }
    </tbody>
</table>

@section Scripts {
    <script>
        // Simple client-side table sorting script
        document.addEventListener('DOMContentLoaded', function () {
            const table = document.getElementById('episodeStatsTable');
            if (!table) return;

            const headers = table.querySelectorAll('th[data-sort]');
            const tbody = table.querySelector('tbody');

            // Find the index of the column that was clicked
            headers.forEach((header, index) => {
                header.addEventListener('click', function () {
                    const sortType = this.getAttribute('data-sort');
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    const direction = this.classList.contains('asc') ? 'desc' : 'asc';

                    // Remove current sort classes
                    headers.forEach(h => h.classList.remove('asc', 'desc'));

                    // Sort the rows
                    rows.sort((a, b) => {
                        let aText = a.children[index].textContent.trim();
                        let bText = b.children[index].textContent.trim();
                        let comparison = 0;

                        if (sortType === 'number') {
                            aText = parseInt(aText.replace(/,/g, ''));
                            bText = parseInt(bText.replace(/,/g, ''));
                            comparison = aText > bText ? 1 : aText < bText ? -1 : 0;
                        } else if (sortType === 'date') {
                            aText = new Date(aText);
                            bText = new Date(bText);
                            comparison = aText > bText ? 1 : aText < bText ? -1 : 0;
                        } else { // string
                            comparison = aText.localeCompare(bText);
                        }

                        return direction === 'asc' ? comparison : comparison * -1;
                    });

                    // Append the sorted rows back to the tbody
                    rows.forEach(row => tbody.appendChild(row));

                    // Add the new sort class
                    this.classList.add(direction);
                });
            });

           
        });
    </script>
}